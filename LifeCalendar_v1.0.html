<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ç­é•·æŒ‡æ®å®˜ V7.2 - ä¸€å±æˆªåœ–ç‰ˆ</title>
    <style>
        :root { --paper: #f9f4e8; --ink: #2e5a44; --red: #c0392b; --gold: #b8860b; --line: #dcd3b6; }
        body { margin: 0; font-family: sans-serif; background: #e8e2d0; -webkit-tap-highlight-color: transparent; }
        .calendar-box { max-width: 500px; margin: 0 auto; background: var(--paper); min-height: 100vh; padding-bottom: 110px; }
        header { background: var(--ink); color: #fff; padding: 8px; text-align: center; position: sticky; top: 0; z-index: 100; }
        .grid { display: grid; grid-template-columns: repeat(7, 1fr); border-top: 1px solid var(--line); }
        .weekday { text-align: center; padding: 5px 0; color: #8e835d; font-size: 12px; background: #f0e9d2; border-bottom: 1px solid var(--line); }
        /* é—œéµä¿®æ­£ï¼šç¸®å°é«˜åº¦å¾ 120px è®Š 85px */
        .cell { min-height: 85px; border-right: 1px solid var(--line); border-bottom: 1px solid var(--line); position: relative; padding: 2px; display: flex; flex-direction: column; background: var(--paper); box-sizing: border-box; }
        .day-num { font-size: 1rem; font-weight: bold; color: #4a4a4a; }
        .is-weekend { color: var(--red); }
        .holiday-label { font-size: 9px; color: var(--red); position: absolute; top: 2px; right: 2px; transform: scale(0.9); }
        
        /* ç¸®å°è¨˜äº‹å­—é«”ä»¥ä¾¿ä¸€å±é¡¯ç¤º */
        .memo-text { font-size: 13px; font-weight: 900; text-align: center; margin: 2px 0; line-height: 1.1; white-space: pre-wrap; width: 100%; }
        .color-default { color: var(--ink); }
        .color-holiday { color: var(--red); }
        .color-special { color: var(--gold); }

        .today { box-shadow: inset 0 0 0 3px var(--red); background: #fffcf5; z-index: 10; }
        .done::after { content: ""; position: absolute; top: 40%; left: 0; width: 100%; height: 4px; background: rgba(192, 57, 43, 0.5); transform: rotate(10deg); pointer-events: none; }
        
        .toolbar { position: fixed; bottom: 0; left: 50%; transform: translateX(-50%); width: 100%; max-width: 500px; background: #f2ebd5; border-top: 2px solid var(--line); padding: 5px 0 env(safe-area-inset-bottom); z-index: 200; }
        .control-row { display: flex; justify-content: space-around; padding: 5px; gap: 5px; }
        select, .clear-btn { padding: 8px 4px; border-radius: 6px; border: 1.5px solid var(--line); background: #fff; font-size: 14px; font-weight: bold; flex: 1; }
    </style>
</head>
<body>
<div class="calendar-box">
    <header>
        <div style="display: flex; justify-content: space-between; align-items: center;">
            <div onclick="changeMonth(-1)" style="font-size:24px; width:40px;">â®</div>
            <div id="calendar-title" style="font-size: 18px; font-weight: bold;">2026å¹´ 3æœˆ</div>
            <div onclick="changeMonth(1)" style="font-size:24px; width:40px;">â¯</div>
        </div>
    </header>
    <div class="grid" id="calendarGrid">
        <div class="weekday">æ—¥</div><div class="weekday">ä¸€</div><div class="weekday">äºŒ</div>
        <div class="weekday">ä¸‰</div><div class="weekday">å››</div><div class="weekday">äº”</div><div class="weekday">å…­</div>
    </div>
</div>
<div class="toolbar">
    <div class="control-row">
        <select id="factorySelect" onchange="updateActiveStamp(this)">
            <option value="">ğŸ¢ å» å€</option>
            <option value="ä¸€å» ">ä¸€å» </option><option value="äºŒå» ">äºŒå» </option><option value="ä¸‰å» ">ä¸‰å» </option>
        </select>
        <select id="typeSelect" onchange="updateActiveStamp(this)">
            <option value="">ğŸ“ é …ç›®</option>
            <option value="æ—¥Bç­">â˜€ï¸æ—¥B</option><option value="å¤œBç­">ğŸŒ™å¤œB</option><option value="å¤œEç­">âš¡å¤œE</option>
            <option value="ä¾‹å‡">ğŸ”´ä¾‹å‡</option><option value="ä¼‘å‡">ğŸŸ¢ä¼‘å‡</option><option value="ç‰¹ä¼‘">â­ç‰¹ä¼‘</option>
        </select>
        <button class="clear-btn" onclick="setClearMode()">æ“¦é™¤</button>
    </div>
</div>
<script>
    let curY = 2026, curM = 2, activeStamp = "", isClearMode = false;
    const holidays = { "1-1": "å…ƒæ—¦", "2-14": "â¤", "2-17": "åˆä¸€", "2-28": "ç´€å¿µæ—¥", "4-4": "å…’ç«¥ç¯€", "5-1": "å‹å‹•ç¯€", "10-10": "åœ‹æ…¶" };
    function updateActiveStamp(el) { isClearMode = false; activeStamp = el.value; }
    function setClearMode() { isClearMode = true; activeStamp = ""; }
    function renderCalendar() {
        const grid = document.getElementById('calendarGrid');
        const weekdays = document.querySelectorAll('.weekday');
        grid.innerHTML = ""; weekdays.forEach(w => grid.appendChild(w));
        document.getElementById('calendar-title').innerText = `${curY}å¹´ ${curM + 1}æœˆ`;
        const firstDay = new Date(curY, curM, 1).getDay();
        const daysInMonth = new Date(curY, curM + 1, 0).getDate();
        const today = new Date();
        for (let i = 0; i < firstDay; i++) grid.appendChild(Object.assign(document.createElement('div'), {className: 'cell'}));
        for (let i = 1; i <= daysInMonth; i++) {
            const cell = document.createElement('div');
            const d = new Date(curY, curM, i);
            cell.className = 'cell';
            const dateKey = `${curY}-${curM + 1}-${i}`;
            if (curY === today.getFullYear() && curM === today.getMonth() && i === today.getDate()) cell.classList.add('today');
            if (localStorage.getItem('done-' + dateKey) === "true") cell.classList.add('done');
            const note = localStorage.getItem('note-' + dateKey) || "";
            let colorClass = "color-default";
            if (note.includes("ä¾‹å‡") || note.includes("ä¼‘å‡")) colorClass = "color-holiday";
            else if (note.includes("ç‰¹ä¼‘")) colorClass = "color-special";
            cell.innerHTML = `<div class="day-num ${d.getDay()===0||d.getDay()===6?'is-weekend':''}">${i}</div>
                              <div class="memo-text ${colorClass}">${note}</div>`;
            cell.onclick = () => {
                const old = localStorage.getItem('note-' + dateKey) || "";
                if (isClearMode) { save(dateKey, "", false); }
                else if (activeStamp) {
                    let f = document.getElementById('factorySelect').value, t = document.getElementById('typeSelect').value;
                    let n = (f && t) ? f + "\n" + t : (f || t);
                    save(dateKey, old ? old + "\n" + n : n, null);
                } else { const n = prompt("è¨˜äº‹ï¼š", old); if (n !== null) save(dateKey, n, null); }
            };
            grid.appendChild(cell);
        }
    }
    function save(k, n, d) { if (n !== null) localStorage.setItem('note-' + k, n); if (d !== null) localStorage.setItem('done-' + k, d); renderCalendar(); }
    function changeMonth(d) { curM += d; if (curM < 0) {curM=11;curY--;} else if (curM>11) {curM=0;curY++;} renderCalendar(); }
    window.onload = renderCalendar;
</script>
</body>
</html>
