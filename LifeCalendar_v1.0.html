<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>班長指揮官 V6.1 - 平板優化</title>
    <style>
        :root { --paper: #f9f4e8; --ink: #2e5a44; --red: #c0392b; --line: #dcd3b6; }
        body { margin: 0; font-family: sans-serif; background: #e8e2d0; -webkit-tap-highlight-color: transparent; }
        .calendar-box { max-width: 800px; margin: 0 auto; background: var(--paper); min-height: 100vh; padding-bottom: 180px; box-shadow: 0 0 30px rgba(0,0,0,0.1); }
        .user-info { background: #1e3d2e; color: #a8bba8; padding: 10px 20px; font-size: 14px; display: flex; justify-content: space-between; border-bottom: 1px solid #142b20; cursor: pointer; }
        header { background: var(--ink); color: #fff; padding: 15px 10px; text-align: center; position: sticky; top: 0; z-index: 100; }
        .grid { display: grid; grid-template-columns: repeat(7, 1fr); border-top: 1px solid var(--line); }
        .weekday { text-align: center; padding: 12px 0; color: #8e835d; font-size: 14px; background: #f0e9d2; font-weight: bold; border-bottom: 1px solid var(--line); }
        
        /* 平板優化：縮小高度避免過長 */
        .cell { min-height: 120px; border-right: 1px solid var(--line); border-bottom: 1px solid var(--line); position: relative; padding: 5px; cursor: pointer; display: flex; flex-direction: column; background: var(--paper); overflow: hidden; box-sizing: border-box; }
        
        .day-num { font-size: 1.3rem; font-weight: bold; color: #4a4a4a; }
        .is-weekend { color: var(--red); }
        .holiday-label { font-size: 11px; color: var(--red); position: absolute; top: 5px; right: 5px; font-weight: bold; }
        
        .memo-text { font-size: 3vw; max-font-size: 20px; color: var(--ink); font-weight: 900; text-align: center; margin: auto 0; white-space: pre-wrap; letter-spacing: -1px; width: 100%; line-height: 1.1; }
        
        @media (min-width: 600px) { .memo-text { font-size: 1.4rem; } .cell { min-height: 150px; } }

        .today { box-shadow: inset 0 0 0 4px var(--red); background: #fffcf5; z-index: 10; }
        .done::after { content: ""; position: absolute; top: 35%; left: -5%; width: 115%; height: 6px; background: rgba(192, 57, 43, 0.6); transform: rotate(10deg); pointer-events: none; border-radius: 10px; }
        
        .toolbar { position: fixed; bottom: 0; left: 50%; transform: translateX(-50%); width: 100%; max-width: 800px; background: #f2ebd5; display: flex; flex-direction: column; z-index: 200; border-top: 2px solid var(--line); padding-bottom: env(safe-area-inset-bottom); }
        .stamp-group { display: flex; justify-content: space-around; padding: 10px 5px; }
        .stamp-btn { padding: 12px 2px; background: #fff; border-radius: 10px; font-weight: bold; border: 1.5px solid var(--line); font-size: 15px; width: 22%; text-align: center; color: #5d5437; box-shadow: 0 2px 5px rgba(0,0,0,0.05); }
        .active-stamp { border-color: var(--ink); background: var(--ink); color: #fff; }
    </style>
</head>
<body>
<div class="calendar-box">
    <div class="user-info" onclick="editUserInfo()">
        <span id="display-name">姓名：載入中...</span>
        <span id="display-id">工號：載入中...</span>
    </div>
    <header>
        <div style="display: flex; justify-content: space-between; align-items: center;">
            <div onclick="changeMonth(-1)" style="font-size:32px; width:60px; cursor:pointer;">❮</div>
            <div id="calendar-title" style="font-size: 26px; font-weight: bold;">2026年 3月</div>
            <div onclick="changeMonth(1)" style="font-size:32px; width:60px; cursor:pointer;">❯</div>
        </div>
    </header>
    <div class="grid" id="calendarGrid">
        <div class="weekday">日</div><div class="weekday">一</div><div class="weekday">二</div>
        <div class="weekday">三</div><div class="weekday">四</div><div class="weekday">五</div><div class="weekday">六</div>
    </div>
</div>
<div class="toolbar">
    <div class="stamp-group">
        <div class="stamp-btn" onclick="setStamp('一廠', this)">一廠</div>
        <div class="stamp-btn" onclick="setStamp('二廠', this)">二廠</div>
        <div class="stamp-btn" onclick="setStamp('三廠', this)">三廠</div>
        <div class="stamp-btn" onclick="setStamp('例假', this)" style="color:var(--red);">例假</div>
    </div>
    <div class="stamp-group">
        <div class="stamp-btn" onclick="setStamp('日B班', this)">日B班</div>
        <div class="stamp-btn" onclick="setStamp('夜B班', this)">夜B班</div>
        <div class="stamp-btn" onclick="setStamp('休假', this)">休假</div>
        <div class="stamp-btn" onclick="setStamp('CLEAR', this)" style="color:var(--red);">擦除</div>
    </div>
</div>
<script>
    let currentYear = 2026;
    let currentMonth = 2; 
    let activeStamp = "";
    const holidays = { "1-1": "元旦", "1-20": "大寒", "2-14": "❤情人節", "2-17": "除夕", "2-18": "春節", "2-28": "紀念日", "4-4": "兒童節", "4-5": "清明節", "5-1": "勞動節", "6-19": "端午節", "8-8": "父親節", "9-25": "中秋節", "10-10": "國慶日" };
    
    function editUserInfo() {
        const n = prompt("姓名：", localStorage.getItem('user-name')||"");
        if (n !== null) {
            const i = prompt("工號：", localStorage.getItem('user-id')||"");
            if (i !== null) { localStorage.setItem('user-name', n); localStorage.setItem('user-id', i); updateUserInfoDisplay(); }
        }
    }
    function updateUserInfoDisplay() {
        document.getElementById('display-name').innerText = "姓名：" + (localStorage.getItem('user-name') || "點擊填寫");
        document.getElementById('display-id').innerText = "工號：" + (localStorage.getItem('user-id') || "點擊填寫");
    }
    function setStamp(t, el) {
        if (activeStamp === t) { activeStamp = ""; el.classList.remove('active-stamp'); }
        else { document.querySelectorAll('.stamp-btn').forEach(b => b.classList.remove('active-stamp')); activeStamp = t; el.classList.add('active-stamp'); }
    }
    function renderCalendar() {
        updateUserInfoDisplay();
        const grid = document.getElementById('calendarGrid');
        const weekdays = document.querySelectorAll('.weekday');
        grid.innerHTML = ""; weekdays.forEach(w => grid.appendChild(w));
        document.getElementById('calendar-title').innerText = `${currentYear}年 ${currentMonth + 1}月`;
        const firstDay = new Date(currentYear, currentMonth, 1).getDay();
        const daysInMonth = new Date(currentYear, currentMonth + 1, 0).getDate();
        const today = new Date();
        for (let i = 0; i < firstDay; i++) grid.appendChild(Object.assign(document.createElement('div'), {className: 'cell empty-cell'}));
        for (let i = 1; i <= daysInMonth; i++) {
            const cell = document.createElement('div');
            const d = new Date(currentYear, currentMonth, i);
            const isWeekend = (d.getDay() === 0 || d.getDay() === 6);
            cell.className = 'cell';
            const dateKey = `${currentYear}-${currentMonth + 1}-${i}`;
            const holidayKey = `${currentMonth + 1}-${i}`;
            if (currentYear === today.getFullYear() && currentMonth === today.getMonth() && i === today.getDate()) cell.classList.add('today');
            if (localStorage.getItem('done-' + dateKey) === "true") cell.classList.add('done');
            const note = localStorage.getItem('note-' + dateKey) || "";
            const hName = holidays[holidayKey] || "";
            cell.innerHTML = `<div class="day-num ${isWeekend?'is-weekend':''}">${i}</div>
                              ${hName?`<div class="holiday-label">${hName}</div>`:''}
                              <div class="memo-text">${note}</div>`;
            cell.onclick = () => {
                const old = localStorage.getItem('note-' + dateKey) || "";
                if (!activeStamp) { const n = prompt("記事：", old); if (n !== null) save(dateKey, n, null); }
                else if (activeStamp === 'CLEAR') { save(dateKey, "", false); }
                else { let n = activeStamp; if (old && !old.includes(activeStamp)) n = old + "\n" + activeStamp; save(dateKey, n, null); }
            };
            grid.appendChild(cell);
        }
    }
    function save(k, n, d) { if (n !== null) localStorage.setItem('note-' + k, n); if (d !== null) localStorage.setItem('done-' + k, d); renderCalendar(); }
    window.onload = renderCalendar;
    function changeMonth(d) { currentMonth += d; if (currentMonth < 0) {currentMonth=11;currentYear--;} else if (currentMonth>11) {currentMonth=0;currentYear++;} renderCalendar(); }
</script>
</body>
</html>
