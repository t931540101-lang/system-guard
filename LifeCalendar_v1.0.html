<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>班長專屬·和風掛曆</title>
    <style>
        :root { 
            --paper: #f9f4e8; /* 溫潤和紙色 */
            --ink: #2e5a44;   /* 質感墨綠 */
            --red: #c0392b;   /* 硃砂紅 */
            --line: #dcd3b6;  /* 舊紙線條色 */
        }
        body { margin: 0; font-family: "PingFang TC", sans-serif; background: #e8e2d0; -webkit-tap-highlight-color: transparent; }
        .calendar-box { max-width: 500px; margin: 0 auto; background: var(--paper); min-height: 100vh; padding-bottom: 120px; box-shadow: 0 0 30px rgba(0,0,0,0.1); }
        
        header { background: var(--ink); color: #fff; padding: 20px 10px; text-align: center; position: sticky; top: 0; z-index: 100; border-bottom: 3px solid #1e3d2e; }
        .header-nav { display: flex; justify-content: space-between; align-items: center; }
        
        .grid { display: grid; grid-template-columns: repeat(7, 1fr); border-top: 1px solid var(--line); }
        .weekday { text-align: center; padding: 12px 0; color: #8e835d; font-size: 13px; background: #f0e9d2; font-weight: bold; border-bottom: 1px solid var(--line); }
        
        .cell { 
            min-height: 140px; border-right: 1px solid var(--line); border-bottom: 1px solid var(--line); 
            position: relative; padding: 6px 2px; cursor: pointer; display: flex; flex-direction: column; 
            background: var(--paper); transition: background 0.2s;
        }
        .empty-cell { background-color: #f2ebd5; }
        .day-num { font-size: 1.4rem; font-weight: bold; color: #4a4a4a; margin-left: 4px; }
        
        /* 今天的高亮：紅框加呼吸感 */
        .today { box-shadow: inset 0 0 0 4px var(--red); background: #fffcf5; z-index: 10; animation: pulse 2s infinite; }
        @keyframes pulse { 0% { opacity: 1; } 50% { opacity: 0.8; } 100% { opacity: 1; } }

        .memo-text { 
            font-size: 4.5vw; color: var(--ink); font-weight: 900; 
            text-align: center; margin: auto 0; white-space: nowrap; 
            letter-spacing: -1.5px; width: 100%; text-shadow: 0.5px 0.5px 0px rgba(255,255,255,0.5);
        }

        @media (min-width: 500px) { .memo-text { font-size: 1.3rem; } }
        
        /* 瀟灑紅線 */
        .done::after { 
            content: ""; position: absolute; top: 35%; left: -5%; width: 115%; height: 6px; 
            background: rgba(192, 57, 43, 0.6); transform: rotate(10deg); pointer-events: none; 
            border-radius: 10px;
        }

        /* 下方工具列美化 */
        .toolbar { 
            position: fixed; bottom: 0; left: 0; width: 100%; background: #f2ebd5; 
            display: flex; justify-content: space-around; padding: 15px 0; 
            box-shadow: 0 -5px 20px rgba(0,0,0,0.1); z-index: 200; border-top: 2px solid var(--line);
        }
        .stamp-btn { 
            padding: 12px 5px; background: #fff; border-radius: 12px; font-weight: bold; 
            border: 1.5px solid var(--line); font-size: 14px; width: 22%; text-align: center;
            color: #5d5437; box-shadow: 0 3px 0 var(--line);
        }
        .stamp-btn:active { transform: translateY(2px); box-shadow: none; }
        .active-stamp { border-color: var(--ink); background: var(--ink); color: #fff; box-shadow: 0 3px 0 #1e3d2e; }
    </style>
</head>
<body>

<div class="calendar-box">
    <header>
        <div class="header-nav">
            <div onclick="changeMonth(-1)" style="font-size:30px; width:50px; cursor:pointer;">❮</div>
            <div id="calendar-title" style="font-size: 24px; font-weight: bold; letter-spacing: 2px;">2026年 3月</div>
            <div onclick="changeMonth(1)" style="font-size:30px; width:50px; cursor:pointer;">❯</div>
        </div>
    </header>
    <div class="grid" id="calendarGrid">
        <div class="weekday">日</div><div class="weekday">一</div><div class="weekday">二</div>
        <div class="weekday">三</div><div class="weekday">四</div><div class="weekday">五</div><div class="weekday">六</div>
    </div>
</div>

<div class="toolbar">
    <div class="stamp-btn" onclick="setStamp('日B班', this)">日B班</div>
    <div class="stamp-btn" onclick="setStamp('夜B班', this)">夜B班</div>
    <div class="stamp-btn" onclick="setStamp('休假', this)">休假</div>
    <div class="stamp-btn" onclick="setStamp('CLEAR', this)" style="color:var(--red);">擦除</div>
</div>

<script>
    let currentYear = 2026;
    let currentMonth = 2; 
    let activeStamp = null;

    function setStamp(type, el) {
        if (activeStamp === type) {
            activeStamp = null;
            el.classList.remove('active-stamp');
        } else {
            document.querySelectorAll('.stamp-btn').forEach(b => b.classList.remove('active-stamp'));
            activeStamp = type;
            el.classList.add('active-stamp');
        }
    }

    function renderCalendar() {
        const grid = document.getElementById('calendarGrid');
        const weekdays = document.querySelectorAll('.weekday');
        grid.innerHTML = "";
        weekdays.forEach(w => grid.appendChild(w));
        document.getElementById('calendar-title').innerText = `${currentYear}年 ${currentMonth + 1}月`;
        const firstDay = new Date(currentYear, currentMonth, 1).getDay();
        const daysInMonth = new Date(currentYear, currentMonth + 1, 0).getDate();
        const today = new Date();

        for (let i = 0; i < firstDay; i++) grid.appendChild(Object.assign(document.createElement('div'), {className: 'cell empty-cell'}));

        for (let i = 1; i <= daysInMonth; i++) {
            const cell = document.createElement('div');
            cell.className = 'cell';
            const dateKey = `${currentYear}-${currentMonth + 1}-${i}`;
            if (currentYear === today.getFullYear() && currentMonth === today.getMonth() && i === today.getDate()) cell.classList.add('today');
            if (localStorage.getItem('done-' + dateKey) === "true") cell.classList.add('done');
            const note = localStorage.getItem('note-' + dateKey) || "";
            cell.innerHTML = `<div class="day-num">${i}</div><div class="memo-text">${note}</div>`;
            
            cell.onclick = () => {
                if (!activeStamp) {
                    const newText = prompt("手動記事：", note);
                    if (newText !== null) save(dateKey, newText, null);
                } else if (activeStamp === 'CLEAR') {
                    save(dateKey, "", false);
                } else {
                    save(dateKey, activeStamp, null);
                }
            };
            // 手機長按劃掉功能
            let timer;
            cell.ontouchstart = () => { timer = setTimeout(() => { 
                const isDone = localStorage.getItem('done-' + dateKey) === "true";
                save(dateKey, null, !isDone);
            }, 600); };
            cell.ontouchend = () => { clearTimeout(timer); };
            grid.appendChild(cell);
        }
    }

    function save(key, note, done) {
        if (note !== null) localStorage.setItem('note-' + key, note);
        if (done !== null) localStorage.setItem('done-' + key, done);
        renderCalendar();
    }

    function changeMonth(dir) {
        currentMonth += dir;
        if (currentMonth < 0) { currentMonth = 11; currentYear--; }
        else if (currentMonth > 11) { currentMonth = 0; currentYear++; }
        renderCalendar();
    }
    window.onload = renderCalendar;
</script>
</body>
</html>
